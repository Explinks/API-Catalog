# 新手指导

本文档对业务接口进行详细地描述，通过该文档可以对本接口有个全面地了解，使商户技术人员尽快掌握本接口，并能够在此基础上进行开发。

## 1.1特别声明

蜜堂有信科技有限公司以下简称“蜜堂”。
未得到蜜堂的书面许可，不得为任何目的、以任何形式或手段（包括但不限于机械的或电子的）复制或传播本文档的任何部分。对于本文档涉及的技术和产品，蜜堂拥有其专利（或正在申请专利）、商标、版权或其它知识产权。除非得到蜜堂的书面许可协议，本文档不授予这些专利、商标、版权或其它知识产权的许可。
本文档因产品功能示例和描述的需要，所使用的任何人名、企业名和数据都是虚构的，并仅限于蜜堂内部测试使用，不等于蜜堂有对任何第三方的承诺和宣传。

## 1.2阅读对象

对接可信认证系统的第三方机构或平台商户的开发人员、需求人员

## 1.3描述

本文档为第三方商户平台对接可信认证系统提供接口接入规范，指导各渠道系统通过可信认证系统实现各种功能。

# **2、通用信息**

## 2.2 返回值处理说明

接口调用时返回http响应状态码及业务处理结果。http响应状态码通过http消息头获取，业务处理结果通过http正文(body)获取。

- http响应状态码

  平台对业务返回值按http状态码语义进行了归类，以便于客户使用、分析、监控。

| http状态码 | 说明              | 处理建议                        |
| :------ | :--------------- | :------------------------------ |
| 401 | 帐号、签名、加密等问题    | 研发阶段解决                     |
| 403 | IP白名单、服务关闭、余额不足、次数不足等问题    | 系统报警，联系客服解决                     |
| 404 | URL不存在，或服务不存在    | 研发阶段解决                     |
| 500 | API网关问题      | 重试                    |
| 503 | 服务维护等问题    | 重试                     |
| 610 | 请求参数问题     | 可将消息直接返回用户 |
| 611 | 系统准备的数据问题    | 一般在调试期解决 |
| 612 | 用户请求行为问题     | 可将消息直接返回用户，并在前端限制用户行为 |

- 业务结果

```text
业务结果包含详细的返回值编码及业务数据，编码格式参考上文返回值示例。
返回值编码FP00000，表示业务处理成功，例如:认证成功、识别成功、查询成功、打款成功、发生短信成功等。
其它返回值编码分为四大类，明细编码参考下文编码清单：
(1) 业务编码
    包含业务处理相关的错误编码。
(2) 参数编码
    参数编码是业务编码的子类，表示用户提供的参数问题，例如：格式、边界、类型、大小等。
(3) 客户端问题编码
    包含商户调用接口时，由于网络协议、传输格式、帐号、权限等不能正常调用的明确原因，以便于客户定位问题。
(4) 服务端问题编码
    包含蜜堂网关、蜜堂应用服务器等由于硬件、路由器、维护、升级、底层供应商渠道抖动等引发的临时不可能用的明确原因，一般情况下，客户只需重试即可解决问题。
```

## 2.3 手续费对账说明

- 收费产品

  http响应状态码200收费，其它不收费。

- 免费产品

  http响应状态码200及其它不收费

- 对账

  发起请求时设置'reqNo'，平台将记录该值，客户从商户后台下载计费明细进行对账。

## 2.4 防止重复请求说明

发起请求时设置扩展属性:特征值('eigenvalue')，则 24 小时内若特征值重复，将拦截重复请求。

返回信息：http状态码611,返回值编码FP09904。


# 3、接口使用案例

以 `身份证二要素验证` 为例，处理流程如下。

## 3.1 业务处理逻辑

```markdown
// 准备 JSON 报文
json = {...}
// 发起请求
httpResponse = sendPost(json)
// 获取 http 状态码
httpStatus = httpResponse.httpCode;
if(httpStatus 为 200){
	if("FP00000"==httpResponse.get("code")){
		http 状态码为 200，且返回值编码为 FP00000 表示业务成功
	}else{
		且返回值编码不是 FP00000 表示业务失败
	}
} else if(httpStatus 为 610){
	用户输入的参数问题，可直接提示用户
} else if(httpStatus 为 611){
	系统准备的数据问题，如 文件数据下载失败、数据不存在、数据重复请求等，
} else if(httpStatus 为 612){
	用户操作频度问题，可提示用户
} else if(500 <= httpStatus < 600){
	在运行阶段发生的系统稳定性问题，客户端可以重试，或者联系我司客服
} else {
	如账户密码错误、IP白名单问题、余额不足等，您应该在对接过程中解决相关问题。
}
```

## 3.2 通讯方式与报文格式

点击这里查看 ☞ [通讯方式与报文格式](/development/simple-auth.html)

## 3.3 简单身份认证调用方式（AppCode模式）

快速对接模式由用户传递AppCode进行权限识别。AppCode在入网完成后由我司提供。

阅读[通讯方式与报文格式](/development/simple-auth.html)可知，简单身份认证调用方式只需要在请求头中填写自己的AppCode即可。

为此我们提供了几个示例共您参考：

<iframe src="/examples/simple/v1toolspersonidcard.html" style="border: none;width:100%;height: 500px;max-width: 800px;"></iframe>

## 3.4 加密/签名认证调用模式(appId/appSecret)

### 3.4.1 使用工具类接入

对于较为复杂的 加密/签名认证调用模式 我们提供了工具类来帮您完成加密与签名逻辑。

为此我们提供了几个示例共您参考：

<iframe src="/examples/security/v1toolspersonidcard.html" style="border: none;width:100%;height: 500px;max-width: 800px;"></iframe>

### 3.4.2 使用SDK接入

由于加密/签名认证调用模式较为复杂，为了方便您的对接我们还提供了一个java版本的SDK。您可以在下面的地址下载：

SDK下载链接：[https://doc.miitang.com/resource/download/gateway_sdk_v2.zip](https://doc.miitang.com/resource/download/gateway_sdk_v2.zip)
